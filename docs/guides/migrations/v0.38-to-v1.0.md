---
order: 4
---

# Upgrading from CometBFT v0.38 to v1.0

This document is intended to provide detailed insights into significant changes that may
require additional information beyond what is covered in the CHANGELOG. It highlights the
changes users must make when migrating from the cometbft `v0.38.x` release line to the
CometBFT `v1.x` and offers comprehensive documentation for these changes.

> **NOTE**: It is essential to emphasize that this is a [major version bump](https://github.com/cometbft/cometbft/blob/main/README.md#versioning)
> upgrade (`v0.38.x` -> `v1.x`). Therefore, a **coordinated upgrade** is necessary. A mixed network with `v0.38.x` and `v1.x` nodes is not supported.

Upgrading from CometBFT `v0.38.x` to `v1.x` involves several important changes, particularly in configuration and functionality.

Hereâ€™s a comprehensive guide to help you with the upgrade process:

## Overview of Changes

CometBFT `v1` introduces several new features, optimizations, and breaking changes.

## Configuration Changes

### Configuration File `config.toml`

Review the `config.toml` file, as several parameters have been added, modified, or deprecated. Review the official
[documentation](https://docs.cometbft.com/v1.0/references/config/config.toml) for `v1` to identify any new fields or
modified data types that need to be included.

#### New Parameters:

Check for newly introduced parameters in the configuration file. You may need to add or
modify these to optimize your node's performance.

```toml
added_parameter = 100
```

#### Removed Parameters:

Some parameters have been removed in `v1.x` and are not applicable anymore.

##### `[mempool]` section:

The `max_batch_bytes` [has been removed](https://github.com/cometbft/cometbft/pull/2050).

```toml
max_batch_bytes = 0
```

#### Changed Parameters:

Some sections changed their structure or naming conventions. Ensure you adapt your configuration accordingly.

##### `[p2p]` section:

The `flush_throttle_timeout` [default value has been lowered](https://github.com/cometbft/cometbft/issues/2988).

Default configuration in `v0.38.x`:
```toml
# Time to wait before flushing messages out on the connection
flush_throttle_timeout = "100ms"
```
Default configuration in `v1.x`:
```toml
# Time to wait before flushing messages out on the connection
flush_throttle_timeout = "10ms"
```

##### `[mempool]` section:

The `max_txs_bytes` [default value has been lowered](https://github.com/cometbft/cometbft/issues/2756).

Default configuration in `v0.38.x`:
```toml
max_txs_bytes = 1073741824
```
Default configuration in `v1.x`:
```toml
max_txs_bytes = 67108864
```

### Genesis File (`genesis.json`)

- **Genesis File Changes**: The format and structure of the genesis file changed in `v1`. Review the official
[documentation](https://docs.cometbft.com/v1.0/references/config/genesis.json) for `v1` to identify any new fields or
modified data types that need to be included.

- **Field Updates**: Update or remove any deprecated fields.

- **Validation**: After updating your genesis file, validate the file's structure
and ensure compatibility with `v1`. This step is crucial to avoid issues during node initialization.

There are new fields or formats, ensure to add them as follows (**TODO**):

```json
{
  "chain_id": "your-chain-id",
  "genesis_time": "2023-01-01T00:00:00Z",
  "app_state": {
    "new_field": "value",  // Example of a new field
    ...
  }
}
```

## New Features

The introduction of CometBFT `v1` brings numerous new features. This section will outline the
most significant additions in `v1`. It is essential to comprehend these features in order to
fully take advantage of CometBFT `v1`.

### Proposer-Based Timestamps (PBTS)

TODO

### Data Companion API

CometBFT `v1.x` introduces support for a new Data Companion Pull API as specified in
[ADR-101](https://docs.cometbft.com/v1.0/references/architecture/adr-101-data-companion-pull-api.md)

There is a whole new section in the `config.toml` to support the new Data Companion gRPC services.

Please refer to the [documentation](https://docs.cometbft.com/v1.0/explanation/data-companion/intro) site for additional
information.

Basically, in the `config.toml` of CometBFT `v1.x`, if the `laddr` parameter in the `[grpc]` section is not specified,
all the services will be **disabled**. If an address is specified, the node operator can selectively choose
which services should be enabled or disabled.

```toml
#######################################################
###       gRPC Server Configuration Options         ###
#######################################################

#
# Note that the gRPC server is exposed unauthenticated. It is critical that
# this server not be exposed directly to the public internet. If this service
# must be accessed via the public internet, please ensure that appropriate
# precautions are taken (e.g. fronting with a reverse proxy like nginx with TLS
# termination and authentication, using DDoS protection services like
# CloudFlare, etc.).
#

[grpc]

# TCP or UNIX socket address for the RPC server to listen on. If not specified,
# the gRPC server will be disabled.
laddr = ""

#
# Each gRPC service can be turned on/off, and in some cases configured,
# individually. If the gRPC server is not enabled, all individual services'
# configurations are ignored.
#

# The gRPC version service provides version information about the node and the
# protocols it uses.
[grpc.version_service]
enabled = true

# The gRPC block service returns block information
[grpc.block_service]
enabled = true

# The gRPC block results service returns block results for a given height. If no height
# is given, it will return the block results from the latest height.
[grpc.block_results_service]
enabled = true

#
# Configuration for privileged gRPC endpoints, which should **never** be exposed
# to the public internet.
#
[grpc.privileged]
# The host/port on which to expose privileged gRPC endpoints.
laddr = ""

#
# Configuration specifically for the gRPC pruning service, which is considered a
# privileged service.
#
[grpc.privileged.pruning_service]

# Only controls whether the pruning service is accessible via the gRPC API - not
# whether a previously set pruning service retain height is honored by the
# node. See the [storage.pruning] section for control over pruning.
#
# Disabled by default.
enabled = false
```

### Database backend

CometBFT `v1` adds experimental support for [Pebble](https://github.com/cockroachdb/pebble) as a database backend.

Use `pebbledb` build tag (`go build -tags pebbledb`) to build a binary that supports this database
backend. Then update the `config.toml` parameter to use this database:

```toml
db_backend = "pebbledb"
```

> **NOTE**: Currently, there is no support available for migrating existing blockchain and state data from a
previous database type (e.g. `goleveldb`) to `pebbledb` for existing network upgrades. If the node
is starting from scratch (not copying or re-using old database files) and performing a block sync,
it can use a binary with this new database. (**VALIDATE**)

## API Changes

As part of the upgrade to CometBFT` v1`, breaking changes have been made to some APIs, enhancing functionality,
These updates may impact how your applications interact with the CometBFT node, necessitating adjustments to your
existing API calls.

It is essential to review these changes carefully to ensure that your application remain functional and take full
advantage of the improvements introduced in `v1`.

### ABCI APIs

TODO

## Removed features

### gRPC Broadcast API

CometBFT `v0.38.x` offered a simplistic gRPC support with only one method equivalent to the `/broadcast_tx_commit` endpoint.
This has been [removed](https://github.com/cometbft/cometbft/pull/659) from CometBFT `v1.x` in favor of
the new [Data Companion gRPC services](https://docs.cometbft.com/v1.0/explanation/data-companion/grpc).

The following configuration parameters in `config.toml` are not applicable in `v1.x` anymore:

```toml
[rpc]

grpc_laddr = ""
grpc_max_open_connections = 900
```

## Deprecation Notices

Review the deprecation notices in the release notes. If you are using any deprecated features, plan to refactor your code or configurations accordingly.

### Deprecated Databases

CometBFT `v1` is upgrading to [cometbft-db v0.14.0](https://github.com/cometbft/cometbft-db/blob/main/CHANGELOG.md#v0140),
which deprecates `cleveldb` and `boltdb`. If you are currently using any of these databases, please note that we
discourage their use, as we plan to discontinue support in future releases.

## Testing and Validation

### Test Your Configuration

Before deploying the upgraded version in a production environment, thoroughly test the new configuration locally or in
a staging or testnet environment.

Monitor logs for any warnings or errors during startup and operation.

### Performance Testing

Conduct performance tests to evaluate the benefits of the upgrade. Compare the results with your previous setup to
ensure improvements are realized.

 ## Additional Resources

- **Release Notes**: Review the [official release notes]() for detailed information on changes and improvements in `v1`.
- **Documentation**: Consult the [CometBFT v1 documentation](https://docs.cometbft.com/v1.0/) for specifics on configuration
parameters and API usage.
- **Community Support**: Engage with the [CometBFT community](https://linktr.ee/cometbft) for assistance or to share
experiences regarding the upgrade process.

By following this guide, you should be well-prepared to successfully upgrade from CometBFT `v0.38.x` to `v1.x`. Ensure you stay
updated with community feedback and best practices post-upgrade.
